<div id="mapid"></div>
<script type="text/javascript">

    var myLines = [{
        {% for line in traces %}
            "type": "LineString",
            "coordinates": {{ line.coordinates }}
            }, {
        {% endfor %}
    }];

    var geoJsonLayer = L.geoJson(myLines);
    var myBounds = geoJsonLayer.getBounds();


    var osm = L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png"),
        topo = L.tileLayer("http://{s}.tile.opentopomap.org/{z}/{x}/{y}.png");


    var baseMaps = {
        "OpenStreetMap": osm,
        "OpenTopoMap": topo
    };

    var overlays = {
        //add any overlays here
    };

    var map = L.map('mapid').fitBounds(myBounds);
    topo.addTo(map);

    L.control.layers(baseMaps, overlays, {position: 'topright'}).addTo(map);

    {% for line in traces %}
        numPts ={{ line.coordinates }}.length;
        var beg = {{ line.coordinates }}[0];
        var end = {{ line.coordinates }}[numPts - 1];

        L.marker([beg[1], beg[0]]).addTo(map);
        L.marker([end[1], end[0]]).addTo(map);
    {% endfor %}

    var myStyle = {
        "color": "{{ color }}",
        "weight": {{ settings.trace_width }},
        "opacity": {{ settings.trace_opacity }}
    };

    L.geoJSON(myLines, {style: myStyle}).addTo(map);
</script>
<br>