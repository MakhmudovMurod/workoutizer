<head>
    <!-- leaflet-ui -->
    <script src="https://unpkg.com/leaflet@1.3.2/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-ui@0.2.0/dist/leaflet-ui.js"></script>
    <!-- leaflet-elevation -->
    <link rel="stylesheet" href="https://unpkg.com/@raruto/leaflet-elevation@latest/leaflet-elevation.css"/>
    <script src="https://unpkg.com/@raruto/leaflet-elevation@latest/leaflet-elevation.js"></script>
</head>
<div id="map"></div>
<script>
    // Full list options at "leaflet-elevation.js"
    var elevation_options = {
        // Default chart colors: theme lime-theme, magenta-theme, ...
        theme: "lightblue-theme",
        // Chart container outside/inside map container
        detached: true,
        // if (detached), the elevation chart container
        elevationDiv: "#elevation-div",
        // if (!detached) autohide chart profile on chart mouseleave
        autohide: false,
        // if (!detached) initial state of chart profile control
        collapsed: false,
        // if (!detached) control position on one of map corners
        position: "topright",
        // Autoupdate map center on chart mouseover.
        followMarker: false,
        // Chart distance/elevation units.
        imperial: false,
        // [Lat, Long] vs [Long, Lat] points. (leaflet default: [Lat, Long])
        reverseCoords: false,
        // Summary track info style: "line" || "multiline" || false,
        summary: false,
    };

    // config options of leaflet-ui plugin: https://github.com/Raruto/leaflet-ui
    var map = L.map('map', {
        center: [41.4583, 12.7059],
        zoom: 5,
        mapTypeId: 'topo',
        mapTypeIds: ['osm', 'terrain', 'satellite', 'topo'],
        gestureHandling: false,     // zoom with Cmd + Scroll
        zoomControl: true,          // plus minus buttons
        pegmanControl: false,
        locateControl: false,
        fullscreenControl: true,
        layersControl: true,
        minimapControl: false,
        editInOSMControl: false,
        loadingControl: false,
        searchControl: false,
        disableDefaultUI: false,
        printControl: false,
    });
    map.once('idle', function () { /* Waiting for map init */
    });

    // Instantiate elevation control.
    {#var controlElevation = L.control.elevation(elevation_options);#}
    {#controlElevation.addTo(map);#}

    // Load track from url (allowed data types: "*.geojson", "*.gpx")
    {#controlElevation.load("https://raruto.github.io/examples/leaflet-elevation/via-emilia.gpx");#}

    {% for line in traces %}
        var coordinates = {{ line.coordinates }};
    {% endfor %}

    var data = {
        "name": "demo.geojson",
        "type": "FeatureCollection",
        "features": [{
            "type": "Feature",
            "geometry": {
                "type": "LineString",
                "coordinates": coordinates,
            }
        }]
    };

    // initialize your elevation control variable.
    var control = L.control.elevation(elevation_options);

    control.geojson = L.geoJson(data, {
        onEachFeature: control.addData.bind(control),
    });

    control.loadChart(map); // initialize your #elevation-div container

    // Really rough trick used to detect when your geojson data is fully loaded
    map.once('layeradd', function (e) {
        map.fitBounds(control.geojson.getBounds());
    });

    control.geojson.addTo(map);

</script>
