<head>
    <!-- Leaflet -->
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <!-- Leaflet-UI -->
    <script src="https://unpkg.com/leaflet-ui@latest/dist/leaflet-ui.js"></script>
</head>

<div id="map"></div>

<script>
    // config options of leaflet-ui plugin: https://github.com/Raruto/leaflet-ui
    var map = L.map('map', {
        mapTypeId: 'topo',
        mapTypeIds: ['osm', 'terrain', 'satellite', 'topo'],
        gestureHandling: false,     // zoom with Cmd + Scroll
        zoomControl: true,          // plus minus buttons
        pegmanControl: false,
        locateControl: false,
        fullscreenControl: true,
        layersControl: true,
        minimapControl: false,
        editInOSMControl: false,
        loadingControl: false,
        searchControl: false,
        disableDefaultUI: false,
        printControl: false,
    });
    map.once('idle', function () { /* Waiting for map init */
    });

    // workoutizer settings for adding traces to map
    var Traces = [{
        {% for line in traces %}
            "type": "LineString",
            "coordinates": {{ line.coordinates }}
            }, {
        {% endfor %}
    }];

    var geoJsonLayer = L.geoJson(Traces);
    var Bounds = geoJsonLayer.getBounds();
    map.fitBounds(Bounds);

    {% for line in traces %}
        numPts ={{ line.coordinates }}.length;
        var beg = {{ line.coordinates }}[0];
        var end = {{ line.coordinates }}[numPts - 1];

        L.marker([beg[1], beg[0]]).addTo(map);
        L.marker([end[1], end[0]]).addTo(map);
    {% endfor %}

    var Style = {
        "color": "{{ color }}",
        "weight": {{ settings.trace_width }},
        "opacity": {{ settings.trace_opacity }}
    };

    L.geoJSON(Traces, {style: Style}).addTo(map);

</script>
<br>